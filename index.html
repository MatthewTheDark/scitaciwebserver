<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Demo website</title>
    <script>
        let number1;
        let number2;
        let operator;
        let result;

        function rannum(min,max) {
            let range = max-min;
            let nc;
            nc = Math.random()*range+min;
            return Math.round(nc);
        }
        function generateProblem() {
            number1 = rannum(1,20);
            number2 = rannum(1,20);
            let operatornum = rannum(1,4);
            if (operatornum === 1){
                operator = "\+";
                result = number1 + number2;
            } else if (operatornum === 2){
                operator = "-";
                result = number1 - number2;
            } else if (operatornum === 3){
                operator = "*";
                result = number1 * number2;
            } else {
                operator = "/";
                number1 = number2 * number1;
                result = number1 / number2;
            }
            document.getElementById("number1").innerHTML = number1;
            document.getElementById("number2").innerHTML = number2;
            document.getElementById("operator").innerHTML = operator;
            //document.getElementById("result").innerHTML = result;
            fetch("http://localhost:8888/log/addproblem?number1="+number1 + "&number2=" + number2 + "&operator=" + operator + "&result=" + result).then(function(response) {
                response.text().then(function(text) {
                    document.getElementById("probleminput").innerHTML = "";
                    //kontrolovat status?
                });
            });
            ListMsg();
        }

        function solveProblem(){
            if (parseInt(document.getElementById("probleminput").value) === result) {
                document.getElementById("response").innerHTML = "Správně!";
                fetch("http://localhost:8888/log/addproblem?number1="+number1 + "&number2=" + number2 + "&operator=" + operator + "&result=" + result).then(function(response) {
                    response.text().then(function(text) {
                        document.getElementById("probleminput").value = "";
                        //kontrolovat status?
                    });
                });
                displayResult()
                generateProblem()
            } else {
                document.getElementById("response").innerHTML = "Špatně!";
            }

            //document.getElementById("response").value = number1;


        }
        function ListMsg(){
            let probleminput = document.getElementById("probleminput").value;
            fetch("http://localhost:8888/log/listproblems").then(function(response) {
                response.text().then(function(text) {
                    let obj = JSON.parse(text);
                    let s = "";
                    for (let o of obj.messages){
                        s = s + "<br>" + o.number1 + " " + o.operator + " " + o.number2 + " = " + o.result + " ";

                    }
                    document.getElementById("minulepriklady").innerHTML = s;



                });
            });
        }
        function displayResult() {
            document.getElementById("response").innerHTML = "";
            document.getElementById("result").innerHTML = "Výsledek je: " + result + "!";
        }
        function onload(){
            generateProblem();
            timer();
        }
        function timer() {
            setInterval(ListMsg, 1000)

        }
    </script>
</head>
<body onload="onload()" style="font-family: 'Lucida Calligraphy',serif; font-style: italic">

<h1>Matematické příklady:</h1>

<br><br>

<div id="minulepriklady"></div>

Kolik je <b id="number1"></b> <b id="operator"></b> <b id="number2"></b> ?

<br><br>

<input type="text" id="probleminput"><input type="button" value="Vyřeš příklad" onclick="solveProblem()">

<b id="response"></b> <b id="result"></b>
<br><br>

<input type="button" value="Zobraz výsledek" onclick="displayResult()"><input type="button" value="Nový příklad" onclick="generateProblem()">

</body>
</html>